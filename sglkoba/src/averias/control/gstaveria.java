package averias.control;import java.sql.SQLException;import java.util.Collection;import util.Listado;import averias.entity.averia;import averias.form.averiaForm;import db.GstTabla;import db.beanConnector; /*************************************************************CLASE GENERADA CON generator V3.0 By pablito*******/public class gstaveria extends GstTabla { public gstaveria() {  db= new beanConnector();  this.classEntidad =averia.class; 
}public gstaveria(beanConnector db) {  this.db= db;  this.classEntidad =averia.class; 
}public Collection getlistaaveria() {String consulta = " SELECT * FROM averia";    return getLista(consulta);  }public Collection getlistaaveria(String start, String param ) { start= start==null ? "0" :  start;   param= param==null ? "" :  param; String consulta = " SELECT * FROM averia where " +  getTextoBusquedaResumen(param) + " order by avecodsx desc " +  "  limit " + this.maxfilas  + " offset  " + (Integer.parseInt(start) * this.maxfilas);     return getLista(consulta);  } public int getTotalPaginaslistaaveria(String param) {  param= param==null ? "" :  param; String consulta = " SELECT count(1) FROM averia where  "  + getTextoBusquedaResumen(param);return getPaginas(consulta);  	}  public boolean crearaveria(String avecompania,String avefecha,String aveingreso,String aveentrada,String avetipo,String aveboddest,String aveposdest,String avecant_pleg_nac,String avecant_pleg_nnac,String avecant_prod_nac,String avecant_prod_nnac,String avesaldo_pleg_nac,String avesaldo_pleg_nnac,String avesaldo_prod_nac,String avesaldo_prod_nnac,String aveestado, String aveproducto, String avecodaveriapadre) throws SQLException { String insert = "INSERT INTO averia (avecompania,avefecha,aveingreso,aveentrada,avetipo," + 		"aveboddest,aveposdest,avecant_pleg_nac,avecant_pleg_nnac,avecant_prod_nac,avecant_prod_nnac," + 		"avesaldo_pleg_nac,avesaldo_pleg_nnac,avesaldo_prod_nac,avesaldo_prod_nnac,aveestado, aveproducto,avecodaveriapadre) VALUES (" +    (avecompania==null ? "NULL" : "'" + avecompania+"'") + "," +   (avefecha==null ? "NULL" : "'" + avefecha+"'") + "," +   (aveingreso==null ? "NULL" : "'" + aveingreso+"'") + "," +   (aveentrada==null ? "NULL" : "'" + aveentrada+"'") + "," +   (avetipo==null ? "NULL" : "'" + avetipo+"'") + "," +   (aveboddest==null ? "NULL" : "'" + aveboddest+"'") + "," +   (aveposdest==null ? "NULL" : "'" + aveposdest+"'") + "," +   (avecant_pleg_nac==null ? "NULL" : "'" + avecant_pleg_nac+"'") + "," +   (avecant_pleg_nnac==null ? "NULL" : "'" + avecant_pleg_nnac+"'") + "," +   (avecant_prod_nac==null ? "NULL" : "'" + avecant_prod_nac+"'") + "," +   (avecant_prod_nnac==null ? "NULL" : "'" + avecant_prod_nnac+"'") + "," +   (avesaldo_pleg_nac==null ? "NULL" : "'" + avesaldo_pleg_nac+"'") + "," +   (avesaldo_pleg_nnac==null ? "NULL" : "'" + avesaldo_pleg_nnac+"'") + "," +   (avesaldo_prod_nac==null ? "NULL" : "'" + avesaldo_prod_nac+"'") + "," +   (avesaldo_prod_nnac==null ? "NULL" : "'" + avesaldo_prod_nnac+"'") + "," +   (aveestado==null ? "NULL" : "'" + aveestado+"'")+ "," + (aveproducto==null ? "NULL" : "'" + aveproducto+"'")+ "," + (avecodaveriapadre==null ? "NULL" : "'" + avecodaveriapadre+"'")+ ")";int resp = db.executeUpdate(insert);return resp ==0 ? false : true;  } public averia getaveria(String avecodsx) { String cad = "SELECT * FROM averia WHERE avecodsx='"+avecodsx+ "'" ; return (averia)getEntidad(cad);  }public boolean updateaveria( averia entity ) throws SQLException {  String cad = " update averia set  " + " avecompania = " + ( entity.getavecompania() == null ? "NULL": "'" + entity.getavecompania() + "'" ) + "," + " avefecha = " + ( entity.getavefecha() == null ? "NULL": "'" + entity.getavefecha() + "'" ) + "," + " aveingreso = " + ( entity.getaveingreso() == null ? "NULL": "'" + entity.getaveingreso() + "'" ) + "," + " aveentrada = " + ( entity.getaveentrada() == null ? "NULL": "'" + entity.getaveentrada() + "'" ) + "," + " avetipo = " + ( entity.getavetipo() == null ? "NULL": "'" + entity.getavetipo() + "'" ) + "," + " aveboddest = " + ( entity.getaveboddest() == null ? "NULL": "'" + entity.getaveboddest() + "'" ) + "," + " aveposdest = " + ( entity.getaveposdest() == null ? "NULL": "'" + entity.getaveposdest() + "'" ) + "," + " avecant_pleg_nac = " + ( entity.getavecant_pleg_nac() == null ? "NULL": "'" + entity.getavecant_pleg_nac() + "'" ) + "," + " avecant_pleg_nnac = " + ( entity.getavecant_pleg_nnac() == null ? "NULL": "'" + entity.getavecant_pleg_nnac() + "'" ) + "," + " avecant_prod_nac = " + ( entity.getavecant_prod_nac() == null ? "NULL": "'" + entity.getavecant_prod_nac() + "'" ) + "," + " avecant_prod_nnac = " + ( entity.getavecant_prod_nnac() == null ? "NULL": "'" + entity.getavecant_prod_nnac() + "'" ) + "," + " avesaldo_pleg_nac = " + ( entity.getavesaldo_pleg_nac() == null ? "NULL": "'" + entity.getavesaldo_pleg_nac() + "'" ) + "," + " avesaldo_pleg_nnac = " + ( entity.getavesaldo_pleg_nnac() == null ? "NULL": "'" + entity.getavesaldo_pleg_nnac() + "'" ) + "," + " avesaldo_prod_nac = " + ( entity.getavesaldo_prod_nac() == null ? "NULL": "'" + entity.getavesaldo_prod_nac() + "'" ) + "," + " avesaldo_prod_nnac = " + ( entity.getavesaldo_prod_nnac() == null ? "NULL": "'" + entity.getavesaldo_prod_nnac() + "'" ) + "," + " aveestado = " + ( entity.getaveestado() == null ? "NULL": "'" + entity.getaveestado() + "'" ) + "," +" aveproducto= " + ( entity.getAveproducto() == null ? "NULL": "'" + entity.getAveproducto() + "'" ) + " where avecodsx = " +  entity.getavecodsx() ;   int resp= db.executeUpdate(cad);      return resp ==0 ? false : true ;      } public boolean updateaveria( averiaForm entity ) throws SQLException {  String cad = " update averia set  " + " avecompania = " + ( entity.getavecompania() == null ? "NULL": "'" + entity.getavecompania() + "'" ) + "," + " avefecha = " + ( entity.getavefecha() == null ? "NULL": "'" + entity.getavefecha() + "'" ) + "," + " aveingreso = " + ( entity.getaveingreso() == null ? "NULL": "'" + entity.getaveingreso() + "'" ) + "," + " aveentrada = " + ( entity.getaveentrada() == null ? "NULL": "'" + entity.getaveentrada() + "'" ) + "," + " avetipo = " + ( entity.getavetipo() == null ? "NULL": "'" + entity.getavetipo() + "'" ) + "," + " aveboddest = " + ( entity.getaveboddest() == null ? "NULL": "'" + entity.getaveboddest() + "'" ) + "," + " aveposdest = " + ( entity.getaveposdest() == null ? "NULL": "'" + entity.getaveposdest() + "'" ) + "," + " avecant_pleg_nac = " + ( entity.getavecant_pleg_nac() == null ? "NULL": "'" + entity.getavecant_pleg_nac() + "'" ) + "," + " avecant_pleg_nnac = " + ( entity.getavecant_pleg_nnac() == null ? "NULL": "'" + entity.getavecant_pleg_nnac() + "'" ) + "," + " avecant_prod_nac = " + ( entity.getavecant_prod_nac() == null ? "NULL": "'" + entity.getavecant_prod_nac() + "'" ) + "," + " avecant_prod_nnac = " + ( entity.getavecant_prod_nnac() == null ? "NULL": "'" + entity.getavecant_prod_nnac() + "'" ) + "," + " avesaldo_pleg_nac = " + ( entity.getavesaldo_pleg_nac() == null ? "NULL": "'" + entity.getavesaldo_pleg_nac() + "'" ) + "," + " avesaldo_pleg_nnac = " + ( entity.getavesaldo_pleg_nnac() == null ? "NULL": "'" + entity.getavesaldo_pleg_nnac() + "'" ) + "," + " avesaldo_prod_nac = " + ( entity.getavesaldo_prod_nac() == null ? "NULL": "'" + entity.getavesaldo_prod_nac() + "'" ) + "," + " avesaldo_prod_nnac = " + ( entity.getavesaldo_prod_nnac() == null ? "NULL": "'" + entity.getavesaldo_prod_nnac() + "'" ) + "," + " aveestado = " + ( entity.getaveestado() == null ? "NULL": "'" + entity.getaveestado() + "'" ) + "," +" aveproducto= " + ( entity.getAveproducto() == null ? "NULL": "'" + entity.getAveproducto() + "'" ) + " where avecodsx = " +  entity.getavecodsx() ;   int resp= db.executeUpdate(cad);      return resp ==0 ? false : true ;      }  public boolean eliminar(String avecodsx) throws SQLException {   String elim = " delete from averia where avecodsx = '"+ avecodsx+ "'"; int r = db.executeUpdate(elim) ; return  r==0? false : true ;  }   public boolean tieneReparaciones(String avecodsx) {	 String cad = "select count(1)  from reparacion_detalle where repdaveria="+ avecodsx;	 String r = getCampo(cad);	 return (r==null || (r!=null && r.equals("0")))? false: true; }  public averia getaveria(String avecompania, String avefecha, String aveingreso, String aveentrada) {	 String cad = "SELECT * FROM averia WHERE avecompania="+avecompania + "  " +	 		" and avefecha='" + avefecha + "'  and aveingreso =" + aveingreso + "  and aveentrada = " + aveentrada ;	 return (averia)getEntidad(cad);  }    public Collection getlistaaveriaProducto(String codcia,String estado, String start, String param ) {	 start= start==null ? "0" :  start;  	 param= param==null ? "" :  param; 	String consulta = " select avecodsx, avecompania, avefecha, promodelo as aveingreso, prodescripcion as aveentrada, avetipo, aveboddest, aveposdest, 0,0,0,0, " +		" avesaldo_pleg_nac,avesaldo_pleg_nnac,avesaldo_prod_nac,avesaldo_prod_nnac , aveestado, averia.resumen, aveproducto " + 		"  from averia, producto, entrada where procodsx = entcodproducto and entcodsx = aveentrada " +		" and avecompania=" + codcia +  " and aveestado='"+ estado +"'  and " + 		getTextoBusquedaResumen("averia" , param) + 	 "  limit " + this.maxfilas  + " offset  " + (Integer.parseInt(start) * this.maxfilas); 	    return getLista(consulta); 	 }	 public int getTotalPaginaslistaaveriaProducto(String codcia,String estado, String param) { 	 param= param==null ? "" :  param; 	String consulta = " select count(1) " + 	"  from averia, producto, entrada where procodsx = entcodproducto and entcodsx = aveentrada " +	" and avecompania=" + codcia +  "  and aveestado='"+ estado +"'  and " + 	getTextoBusquedaResumen("averia",param);	return getPaginas(consulta); 	 	}  public Collection getListaAveriaSaldoProductoNAC(String compania, String start, String param) {	 start= start==null ? "0" :  start;  	 param= param==null ? "" :  param; 	 String cad = "select procodsx, promodelo, prodescripcion, sum(avesaldo_pleg_nac) as pleg  , sum( avesaldo_prod_nac ) as prod, (sum(avesaldo_pleg_nac)   + sum( avesaldo_prod_nac ) ) as total,'' " +			"	from producto, averia "+			"	where avecompania = " + compania + " and  procodsx = aveproducto and aveestado='FINALIZADO' and "+			getTextoBusquedaResumen("averia", param) +			"	group by promodelo, prodescripcion , procodsx ";	 this.classEntidad = Listado.class;	 Collection resp = getLista(cad);	 this.classEntidad = averia.class;	 	 return resp; } public int getTotalPaginasListaAveriaSaldoProductoNAC(String compania, String param) {		 param= param==null ? "" :  param; 		String consulta = " select count( distinct aveproducto) from averia  where avecompania = " +compania +		" and aveestado='FINALIZADO'  and " + 		getTextoBusquedaResumen("averia",param);		return getPaginas(consulta); }public Collection getListaAveriaSaldoProductoNNAC(String compania, String start, String param) {	 start= start==null ? "0" :  start;  	 param= param==null ? "" :  param; 	 String cad = "select procodsx, promodelo, prodescripcion, " +			"	sum( avesaldo_pleg_nnac ) as pleg, sum( avesaldo_prod_nnac ) as sprod, (sum(avesaldo_pleg_Nnac)   + sum( avesaldo_prod_nNac ) ) as total ,'' "+			"	from producto, averia "+			"	where avecompania = " + compania + " and  procodsx = aveproducto and aveestado='FINALIZADO' and "+			getTextoBusquedaResumen("averia", param) +			"	group by promodelo, prodescripcion , procodsx ";	 this.classEntidad = Listado.class;	 Collection resp = getLista(cad);	 this.classEntidad = averia.class;	 	 return resp;}public int getTotalPaginasListaAveriaSaldoProductoNNAC(String compania, String param) {		 param= param==null ? "" :  param; 		String consulta = " select count( distinct aveproducto) from averia  where avecompania = " +compania +		" and aveestado='FINALIZADO'  and " + 		getTextoBusquedaResumen("averia",param);		return getPaginas(consulta); }public Collection getlistaaveriaFifoReparacion(String producto, String saldo, String destino) {	String consulta = "";	Collection resp = null;	if(saldo.equals("NAC")) {		if(destino.equals("PLEGADIZA")) {			//solo de plegadiza:			consulta = "select * from averia where aveproducto = "+ producto +" and avesaldo_pleg_nac>0 and aveestado='FINALIZADO'  order by avecodsx asc";			resp = getLista(consulta);		}else {			//es de DESPIECE, toma  lo de producto			consulta = "select * from averia where aveproducto = "+ producto +" and avesaldo_prod_nac>0 and aveestado='FINALIZADO'  order by avecodsx asc";			resp = getLista(consulta);		}			}else {		if(destino.equals("PLEGADIZA")) {			//solo de plegadiza:			consulta = "select * from averia where aveproducto = "+ producto +" and avesaldo_pleg_nnac>0 and aveestado='FINALIZADO'  order by avecodsx asc";			resp = getLista(consulta);		}else {			//es de DESPIECE, toma  lo de producto			consulta = "select * from averia where aveproducto = "+ producto +" and avesaldo_prod_nnac>0 and aveestado='FINALIZADO'  order by avecodsx asc";			resp = getLista(consulta);		}			}		    return resp; 	 }public String getSaldoAveriado(String procodsx){	String cadena ="select sum(avesaldo_pleg_nac)+ sum(avesaldo_pleg_nnac )+ sum(avesaldo_prod_nac )+ sum(avesaldo_prod_nnac) " +				" from averia where aveproducto = " + procodsx;	String resp =getCampo(cadena);	return resp ==null || (resp!=null && resp.equals("")) ? "0.00" : resp; }public Collection getlistaAveriaIngresos(String ingcodsx){	String cad= "select averia.* from averia where aveingreso   =" + ingcodsx;	return getLista(cad);} }